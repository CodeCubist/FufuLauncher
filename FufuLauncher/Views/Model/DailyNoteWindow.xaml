<Window
    x:Class="FufuLauncher.Views.DailyNoteWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:controls="using:Microsoft.UI.Xaml.Controls"
    mc:Ignorable="d"
    Title="提瓦特日程">

    <Grid Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <Grid x:Name="AppTitleBar" Height="40" VerticalAlignment="Top" Padding="16,0,0,0" Background="{ThemeResource LayerFillColorDefaultBrush}">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="138"/> </Grid.ColumnDefinitions>
            
            <StackPanel Orientation="Horizontal" Spacing="10" VerticalAlignment="Center">
                <Image Source="/Assets/WindowIcon.ico" Width="18" Height="18"/>
                <TextBlock Text="提瓦特日程" Style="{StaticResource SubtitleTextBlockStyle}" FontSize="14"/>
            </StackPanel>
            
            <Button Grid.Column="2" Click="OnRefreshClick" Padding="8,4" Background="Transparent" BorderThickness="0" ToolTipService.ToolTip="刷新数据">
                <FontIcon Glyph="&#xE72C;" FontSize="14" FontFamily="{ThemeResource SymbolThemeFontFamily}"/>
            </Button>
        </Grid>

        <Pivot Grid.Row="1" x:Name="MainPivot">
            <PivotItem Header="今日素材">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <Border Margin="12,8,12,0" Padding="16" CornerRadius="8" 
                            Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" 
                            BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <StackPanel>
                                <TextBlock Text="{x:Bind TodayDate, Mode=OneWay}" FontSize="20" FontWeight="SemiBold"/>
                                <TextBlock Text="每日采集 &amp; 掉落提醒" Opacity="0.6" FontSize="12" Margin="0,4,0,0"/>
                            </StackPanel>
                        </Grid>
                    </Border>

                    <ScrollViewer Grid.Row="1" Padding="12">
                        <ItemsControl ItemsSource="{x:Bind MaterialGroups, Mode=OneWay}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <StackPanel Margin="0,0,0,24">
                                        <Border Background="{ThemeResource LayerFillColorAltBrush}" HorizontalAlignment="Left" CornerRadius="4" Padding="10,4" Margin="0,0,0,12">
                                            <TextBlock Text="{Binding CategoryName}" FontSize="14" FontWeight="Bold"/>
                                        </Border>
                    
                                        <GridView ItemsSource="{Binding Items}" SelectionMode="None">
                                            <GridView.ItemTemplate>
                                                <DataTemplate>
                                                    <Grid Width="150" Height="200" Background="{ThemeResource LayerFillColorDefaultBrush}" CornerRadius="8" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1" Margin="0,0,8,8">
                                                        <Grid.RowDefinitions>
                                                            <RowDefinition Height="Auto"/> <RowDefinition Height="*"/>    <RowDefinition Height="Auto"/> </Grid.RowDefinitions>

                                                        <Grid Height="64" Background="{ThemeResource CardBackgroundFillColorSecondaryBrush}" CornerRadius="8,8,0,0">
                                                            <StackPanel Orientation="Horizontal" VerticalAlignment="Center" Margin="10,0">
                                                                <Ellipse Width="44" Height="44" StrokeThickness="1" Stroke="#10000000">
                                                                    <Ellipse.Fill>
                                                                        <ImageBrush ImageSource="{Binding IconImage}"/>
                                                                    </Ellipse.Fill>
                                                                </Ellipse>
                                                                <TextBlock Text="{Binding Name}" VerticalAlignment="Center" Margin="10,0,0,0" FontSize="13" TextTrimming="CharacterEllipsis" MaxWidth="75" FontWeight="SemiBold"/>
                                                            </StackPanel>
                                                        </Grid>

                                                        <ItemsControl Grid.Row="1" ItemsSource="{Binding Materials}" HorizontalAlignment="Center" VerticalAlignment="Center" Margin="0,8">
                                                            <ItemsControl.ItemsPanel>
                                                                <ItemsPanelTemplate>
                                                                    <StackPanel Orientation="Horizontal" Spacing="-4"/> </ItemsPanelTemplate>
                                                            </ItemsControl.ItemsPanel>
                                                            <ItemsControl.ItemTemplate>
                                                                <DataTemplate>
                                                                    <Ellipse Width="36" Height="36" Stroke="{ThemeResource LayerFillColorDefaultBrush}" StrokeThickness="2">
                                                                        <Ellipse.Fill>
                                                                            <ImageBrush ImageSource="{Binding}"/>
                                                                        </Ellipse.Fill>
                                                                    </Ellipse>
                                                                </DataTemplate>
                                                            </ItemsControl.ItemTemplate>
                                                        </ItemsControl>

                                                        <Border Grid.Row="2" Background="{ThemeResource LayerFillColorAltBrush}" Padding="6" CornerRadius="0,0,8,8" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="0,1,0,0">
                                                            <TextBlock Text="{Binding DomainName}" FontSize="11" HorizontalAlignment="Center" Opacity="0.8" TextTrimming="CharacterEllipsis"/>
                                                        </Border>
                                                    </Grid>
                                                </DataTemplate>
                                            </GridView.ItemTemplate>
                                        </GridView>
                                    </StackPanel>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </ScrollViewer>
                    
                    <Grid Visibility="{x:Bind IsLoadingMaterials, Mode=OneWay}" Background="{ThemeResource ApplicationPageBackgroundThemeBrush}" Opacity="0.9">
                        <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center" Spacing="10">
                            <ProgressRing IsActive="True" Width="48" Height="48"/>
                            <TextBlock Text="{x:Bind StatusText, Mode=OneWay}" Opacity="0.8"/>
                        </StackPanel>
                    </Grid>
                </Grid>
            </PivotItem>

            <PivotItem Header="近期活动">
                <Grid>
                    <GridView ItemsSource="{x:Bind Activities, Mode=OneWay}" Padding="12" SelectionMode="None">
                        <GridView.ItemTemplate>
                            <DataTemplate>
                                <Grid Width="380" Height="120" Background="{ThemeResource LayerFillColorDefaultBrush}" CornerRadius="8" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1" Margin="0,0,12,12">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="200"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    
                                    <Image Source="{Binding Image}" Stretch="UniformToFill" HorizontalAlignment="Left" Width="200" Height="120"/>
                                    
                                    <StackPanel Grid.Column="1" Padding="12,10">
                                        <TextBlock Text="{Binding Title}" FontSize="14" FontWeight="Bold" TextWrapping="NoWrap" TextTrimming="CharacterEllipsis"/>
                                        <TextBlock Text="{Binding Subtitle}" FontSize="12" Opacity="0.7" Margin="0,6,0,0" TextWrapping="Wrap" MaxLines="2" TextTrimming="CharacterEllipsis" Height="36"/>
                                        
                                        <Border Background="{ThemeResource SystemControlHighlightAccent2RevealBackgroundBrush}" HorizontalAlignment="Left" CornerRadius="4" Padding="8,2" Margin="0,10,0,0">
                                            <StackPanel Orientation="Horizontal" Spacing="4">
                                                <FontIcon Glyph="&#xE823;" FontSize="10" Foreground="{ThemeResource SystemAccentColor}" FontFamily="{ThemeResource SymbolThemeFontFamily}"/>
                                                <TextBlock Text="{Binding Countdown}" FontSize="11" Foreground="{ThemeResource SystemAccentColor}" FontWeight="Bold"/>
                                            </StackPanel>
                                        </Border>
                                    </StackPanel>
                                </Grid>
                            </DataTemplate>
                        </GridView.ItemTemplate>
                    </GridView>
                    
                    <Grid Visibility="{x:Bind IsLoadingActivities, Mode=OneWay}" Background="{ThemeResource ApplicationPageBackgroundThemeBrush}" Opacity="0.9">
                         <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center" Spacing="10">
                            <ProgressRing IsActive="True" Width="48" Height="48"/>
                            <TextBlock Text="{x:Bind StatusText, Mode=OneWay}" Opacity="0.8"/>
                        </StackPanel>
                    </Grid>
                </Grid>
            </PivotItem>
        </Pivot>

        <controls:WebView2 x:Name="ScraperWebView" 
                           Grid.Row="0" 
                           Width="1" Height="1" 
                           Opacity="0" 
                           IsHitTestVisible="False"
                           DefaultBackgroundColor="Transparent"/>
    </Grid>
</Window>