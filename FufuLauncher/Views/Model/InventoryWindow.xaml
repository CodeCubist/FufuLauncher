<Window
    x:Class="FufuLauncher.Views.InventoryWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:FufuLauncher.Views"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:helpers="using:FufuLauncher.Helpers"
    mc:Ignorable="d"
    Title="背包物品与目标规划">

    <Grid Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">
        <Grid.Resources>
            <helpers:BoolToVisibilityConverter x:Key="BoolToVis" />
        </Grid.Resources>

        <Grid.RowDefinitions>
            <RowDefinition Height="48"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <Grid x:Name="AppTitleBar" Grid.Row="0" Padding="28,0,28,0" VerticalAlignment="Stretch">
            <TextBlock Text="库存管理" VerticalAlignment="Center" Style="{ThemeResource CaptionTextBlockStyle}" FontWeight="Bold"/>
            <StackPanel HorizontalAlignment="Right" Orientation="Horizontal" Spacing="12" Margin="0,0,140,0">
                <TextBlock x:Name="StatusText" VerticalAlignment="Center" Style="{ThemeResource CaptionTextBlockStyle}" 
                           Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                <Button x:Name="RefreshButton" Style="{ThemeResource AccentButtonStyle}" VerticalAlignment="Center" Click="OnRefreshClick">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <FontIcon Glyph="&#xE72C;" FontSize="12"/>
                        <TextBlock Text="立即更新" FontSize="12"/>
                    </StackPanel>
                </Button>
            </StackPanel>
        </Grid>

        <Pivot Grid.Row="1">
            <PivotItem Header="我的背包">
                <ScrollViewer Padding="20,10,20,0">
                    <GridView x:Name="InventoryGridView" SelectionMode="None" IsItemClickEnabled="False" HorizontalAlignment="Center">
                        <GridView.ItemTemplate>
                            <DataTemplate>
                                <Grid Margin="4" ToolTipService.ToolTip="{Binding Name}">
                                    <Border Width="110" Height="130" Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" 
                                            BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1" CornerRadius="8">
                                        <Grid>
                                            <Grid.RowDefinitions>
                                                <RowDefinition Height="*"/>
                                                <RowDefinition Height="Auto"/>
                                            </Grid.RowDefinitions>

                                            <Image Grid.Row="0" Width="64" Height="64" Margin="0,12,0,0" HorizontalAlignment="Center" VerticalAlignment="Top">
                                                <Image.Source>
                                                    <BitmapImage UriSource="{Binding IconUrl}" DecodePixelWidth="128" CreateOptions="IgnoreImageCache" />
                                                </Image.Source>
                                            </Image>

                                            <Border Grid.Row="0" HorizontalAlignment="Left" VerticalAlignment="Top" Margin="8,8,0,0" 
                                                    Visibility="{Binding IsTargetMet, Converter={StaticResource BoolToVis}}">
                                                <FontIcon Glyph="&#xE73E;" FontSize="18" Foreground="{ThemeResource SystemFillColorSuccessBrush}" />
                                            </Border>

                                            <Border Grid.Row="0" HorizontalAlignment="Right" VerticalAlignment="Bottom" Margin="0,0,8,4" Padding="6,1" 
                                                    Background="{ThemeResource SystemControlBackgroundChromeMediumLowBrush}" CornerRadius="4">
                                                <TextBlock Text="{Binding ProgressText}" Style="{ThemeResource CaptionTextBlockStyle}" FontWeight="SemiBold"/>
                                            </Border>

                                            <TextBlock Grid.Row="1" Text="{Binding Name}" TextAlignment="Center" FontSize="11" Margin="4,0,4,10" 
                                                       TextTrimming="CharacterEllipsis" Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                        </Grid>
                                    </Border>
                                </Grid>
                            </DataTemplate>
                        </GridView.ItemTemplate>
                        <GridView.ItemsPanel>
                            <ItemsPanelTemplate>
                                <ItemsWrapGrid Orientation="Horizontal" HorizontalAlignment="Center"/>
                            </ItemsPanelTemplate>
                        </GridView.ItemsPanel>
                    </GridView>
                </ScrollViewer>
            </PivotItem>

            <PivotItem Header="目标设置">
                <ListView x:Name="TargetListView" SelectionMode="None" Margin="20,10">
                    <ListView.Header>
                        <Grid Margin="12,0,12,10">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="40"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="150"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Grid.Column="1" Text="物品名称" Style="{ThemeResource CaptionTextBlockStyle}" Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                            <TextBlock Grid.Column="2" Text="目标数量" Style="{ThemeResource CaptionTextBlockStyle}" Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                        </Grid>
                    </ListView.Header>
                    <ListView.ItemTemplate>
                        <DataTemplate>
                            <Grid Margin="0,4">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="40"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="150"/>
                                </Grid.ColumnDefinitions>
                                <Image Source="{Binding IconUrl}" Width="32" Height="32"/>
                                <TextBlock Grid.Column="1" Text="{Binding Name}" VerticalAlignment="Center" Margin="12,0"/>
                                <NumberBox Grid.Column="2" Value="{Binding TargetCount, Mode=TwoWay}" 
                                           SpinButtonPlacementMode="Compact" SmallChange="1" 
                                           ValueChanged="OnTargetValueChanged" HorizontalAlignment="Stretch"/>
                            </Grid>
                        </DataTemplate>
                    </ListView.ItemTemplate>
                </ListView>
            </PivotItem>
        </Pivot>

        <Border Grid.Row="2" Padding="24,10" Background="{ThemeResource LayerFillColorDefaultBrush}" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="0,1,0,0">
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Spacing="6">
                <FontIcon Glyph="&#xE946;" FontSize="12" Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                <TextBlock Text="达成目标后，物品左上角会自动显示勾选标志" Style="{ThemeResource CaptionTextBlockStyle}" Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
            </StackPanel>
        </Border>
    </Grid>
</Window>